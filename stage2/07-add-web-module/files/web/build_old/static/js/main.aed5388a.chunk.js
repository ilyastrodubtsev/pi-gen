(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,n){},110:function(e,t,n){},111:function(e,t,n){},112:function(e,t,n){},113:function(e,t,n){},127:function(e,t,n){},128:function(e,t,n){},129:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),s=n(18),r=n.n(s);n(81),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i=n(9),c=n(7),l=n(12),u=n(10),d=n(11),h=(n(58),n(82),n(14)),m=n.n(h),p=n(36),f=n(33),v=n(20),b=n(35),g=(n(85),n(130)),y=n(69),w=n(53),k=n(28),j=n(13),E=n(2),O=n.n(E),C=(window,function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={active:!1},n.a=o.a.createRef(),n.onClick=function(e){n.props.onClick&&n.props.onClick(Object(b.a)(Object(b.a)(n)),e)},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("a",{href:"#",ref:this.a,className:O()("list-group-item","list-group-item-action",{active:this.state.active}),onClick:this.props.onClick&&this.props.onClick.bind(this,this)},o.a.createElement("div",{className:"d-flex my-bg-inherit"},o.a.createElement("div",{className:"p-2 flex-grow-1"},this.props.text),o.a.createElement("div",{className:"p-2"},o.a.createElement(k.a,{icon:this.props.locked?j.f:j.l})),o.a.createElement("div",{className:"p-2 my-bg-inherit"},o.a.createElement(k.a,{icon:j.k}),o.a.createElement("div",{className:"mystencil my-bg-inherit mystencil-"+this.props.bars}))))}},{key:"activate",value:function(e){this.setState({active:e})}},{key:"scroll",value:function(){this.a.current.scrollIntoView()}},{key:"value",get:function(){return this.props.text}},{key:"locked",get:function(){return this.props.locked}}]),t}(a.Component));C.defaultProps={bars:"5"};var S=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={compact:!1,items:[]},n.selected=null,n.onItemClick=function(e,t){n.state.compact||(console.log(t.currentTarget,e),e.activate(!0),n.selected=e,n.setState({compact:!0},function(){n.props.onSelect()}))},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"fetchNetworks",value:function(){var e=Object(v.a)(m.a.mark(function e(){var t,n,a,o,s,r,i,c,l,u,d,h,v,b,g,y,w,k,j,E,O;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://192.168.42.1:8090/networks");case 2:return t=e.sent,e.next=5,t.body.getReader().read();case 5:n=e.sent,a=new TextDecoder("utf-8").decode(n.value),o=JSON.parse(a),s=new Map,r=[],i=!0,c=!1,l=void 0,e.prev=11,u=o[Symbol.iterator]();case 13:if(i=(d=u.next()).done){e.next=21;break}if(h=d.value,!s.has(h.ssid)&&h.ssid){e.next=17;break}return e.abrupt("continue",18);case 17:s.set(h.ssid,{locked:"none"!=h.security,bars:Math.ceil(h.strength/20)});case 18:i=!0,e.next=13;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(11),c=!0,l=e.t0;case 27:e.prev=27,e.prev=28,i||null==u.return||u.return();case 30:if(e.prev=30,!c){e.next=33;break}throw l;case 33:return e.finish(30);case 34:return e.finish(27);case 35:for(v=!0,b=!1,g=void 0,e.prev=38,y=s[Symbol.iterator]();!(v=(w=y.next()).done);v=!0)k=w.value,j=Object(f.a)(k,2),E=j[0],O=j[1],r.push(Object(p.a)({text:E},O));e.next=46;break;case 42:e.prev=42,e.t1=e.catch(38),b=!0,g=e.t1;case 46:e.prev=46,e.prev=47,v||null==y.return||y.return();case 49:if(e.prev=49,!b){e.next=52;break}throw g;case 52:return e.finish(49);case 53:return e.finish(46);case 54:this.setState({items:r});case 55:case"end":return e.stop()}},e,this,[[11,23,27,35],[28,,30,34],[38,42,46,54],[47,,49,53]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.fetchNetworks()}},{key:"scroll",value:function(){this.selected.scroll()}},{key:"reset",value:function(){this.setState({compact:!1}),this.selected.activate(!1)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:O()("list-group","rounded","border","mylistgroup")},this.state.items.map(function(t){return o.a.createElement(C,{text:t.text,locked:t.locked,bars:t.bars,key:t.text,onClick:e.onItemClick})}))}},{key:"selectedName",get:function(){return this.selected.value}},{key:"selectedNeedsPassword",get:function(){return this.selected.locked}}]),t}(a.Component),x=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state=t.defaultState,n.list=o.a.createRef(),n.passwordField=o.a.createRef(),n.passwordDiv=o.a.createRef(),n.wrapper=o.a.createRef(),n.onSelect=function(){n.setState({showPasswordField:n.list.current.selectedNeedsPassword,valid:!n.list.current.selectedNeedsPassword,compact:!0,headerText:"Enter password"},function(){setTimeout(function(){n.passwordField.current.select(),n.list.current.scroll()},0)})},n.onBack=function(){n.state.compact?(n.setState(t.defaultState),n.list.current.reset()):n.props.onBack()},n.onPasswordChange=function(e){console.log(e.target.value.length),n.setState({valid:e.target.value.length>=8,password:e.target.value})},n.onSubimt=function(e){e.preventDefault(),n.state.valid&&n.props.onSubmit(n.list.current.selectedName,n.state.password)},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:O()("mylist d-flex flex-column border rounded shadow mx-auto  p-3 mb-5 bg-white",this.props.className,{"mylist-compact":this.state.compact})},o.a.createElement("nav",{className:"navbar navbar-dark bg-secondary flex-shrink-0"},o.a.createElement("span",{className:"navbar-brand",style:{width:"100%"}},o.a.createElement("div",{className:"d-flex"},o.a.createElement("div",{className:"p-2 flex-grow-1 bd-highlight"},this.state.headerText),o.a.createElement("div",{className:"p-2 bd-highlight"},o.a.createElement(k.a,{icon:j.m}))))),o.a.createElement(S,{onSelect:this.onSelect,className:"flex-shrink-1",ref:this.list}),o.a.createElement(g.a,{in:this.state.showPasswordField},o.a.createElement("form",{ref:this.passwordDiv,className:O()("flex-shrink-0","form-group","my-1","fade",{}),onSubmit:this.onSubimt},o.a.createElement("input",{type:"password",className:"form-control",placeholder:"Password",onChange:this.onPasswordChange,value:this.state.password,ref:this.passwordField}))),o.a.createElement("div",{className:"d-flex flex-shrink-0 justify-content-end my-3"},o.a.createElement(y.a,{type:"submit",variant:"secondary",className:"mx-2",onClick:this.onBack},"Back"),o.a.createElement(y.a,{type:"submit",variant:this.state.compact?"primary":"secondary",onClick:this.onSubimt,disabled:!this.state.valid},"Connect")))}}]),t}(a.Component);x.defaultState={valid:!1,showPasswordField:!1,compact:!1,headerText:"Choose network",password:""},x.defaultProps={className:""};var M=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:O()("mylist d-flex flex-column border rounded shadow mx-auto  p-3 mb-5 bg-white mylist-compact",this.props.className)},o.a.createElement("div",{className:"alert alert-success",role:"alert"},o.a.createElement("h4",{className:"alert-heading"},"Done"),o.a.createElement("p",null,"Raspberry Pi is trying to connect to the chosen WiFi network now."),o.a.createElement("hr",null),o.a.createElement("p",{className:"mb-0"},"If it fails to do so, this page will be available again soon.")))}}]),t}(a.Component),T=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:O()("mylist border rounded shadow mx-auto  p-3 mb-5 bg-white mylist-compact",this.props.className)},o.a.createElement("div",{className:"jumbotron"},o.a.createElement("h1",{className:"display-5"},"Pi Robot"),o.a.createElement("p",{className:"lead"},"Chooose what to do now:"),o.a.createElement("hr",{className:"my-3"}),o.a.createElement("p",null,"Try to connect to a WiFi network."),o.a.createElement(y.a,{variant:"primary",size:"lg",onClick:this.props.onSubmit},"Connect!"),o.a.createElement("hr",{className:"my-3"}),o.a.createElement("p",null,"Launch the driving interface."),o.a.createElement(y.a,{variant:"primary",size:"lg",onClick:this.props.onDrive},"Drive!")))}}]),t}(a.Component),N=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={successVisible:!1,successCollapsed:!1,wifiWizardVisible:!1,wifiWizardCollapsed:!1,startVisible:!0,startCollapsed:!1,next:"wifiwizard"},n.onWifiSubmit=function(e,t){console.log(e,t);var a=JSON.stringify({name:e,passphrase:t});fetch("https://192.168.42.1/connect",{method:"POST",body:a}).then(function(){n.setState({wifiWizardCollapsed:!0})})},n.onWifiBack=function(){n.setState({wifiWizardCollapsed:!0,next:"start"})},n.onWifiWizardHidden=function(e){console.log(e),"wifiwizard"==n.state.next?n.setState({wifiWizardVisible:!1,successVisible:!0,next:"success"}):n.setState({wifiWizardVisible:!1,startVisible:!0,startCollapsed:!1,next:"wifiwizard"})},n.onStartSubmit=function(e){n.setState({startCollapsed:!0})},n.onStartHidden=function(e){n.setState({startVisible:!1,wifiWizardCollapsed:!1,wifiWizardVisible:!0})},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,this.state.startVisible&&o.a.createElement(w.a,{appear:!0,in:!this.state.startCollapsed,onExited:this.onStartHidden},o.a.createElement(T,{onSubmit:this.onStartSubmit,onDrive:this.props.onDrive})),this.state.successVisible&&o.a.createElement(w.a,{appear:!0,in:!this.state.successCollapsed},o.a.createElement(M,null)),this.state.wifiWizardVisible&&o.a.createElement(w.a,{appear:!0,in:!this.state.wifiWizardCollapsed,onExited:this.onWifiWizardHidden},o.a.createElement(x,{onSubmit:this.onWifiSubmit,onBack:this.onWifiBack})))}}]),t}(a.Component),D=n(22);n(98),n(99);function W(){return z.apply(this,arguments)}function z(){return(z=Object(v.a)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){window.requestAnimationFrame(e)}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var R="ontouchstart"in window,A=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={animationName:""},n.onClick=function(e){console.log("onClick"),n.onTouchStart(e)},n.onTouchStart=function(){var e=Object(v.a)(m.a.mark(function e(t){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onTouchStart"),n.props.onClick(t),e.next=4,n.setStateAsync({animationName:""});case 4:return e.next=6,W();case 6:return e.next=8,W();case 8:return e.next=10,n.setStateAsync({animationName:"animated"});case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.onTouchEnd=function(e){console.log("onTouchEnd"),n.props.embed&&e.preventDefault()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"setStateAsync",value:function(e){var t=this;return new Promise(function(n){t.setState(e,n)})}},{key:"render",value:function(){var e,t,n;if(!this.props.canTouch){var a=[this.onTouchStart,this.onTouchEnd];e=a[0],t=a[1]}return!this.props.canTouch&&R||(n=this.onClick),o.a.createElement("div",{className:this.props.embed?"":"inline-div",id:this.props.id,style:Object(p.a)({},this.props.style)},o.a.createElement("div",{className:"flex-div"},o.a.createElement("button",{className:"flex-a flex-animated ".concat(this.props.disabled?"toolButton-disabled":""),onTouchStart:e,onTouchEnd:t,onClick:n,style:Object(p.a)({animationName:this.state.animationName},this.props.buttonStyle)},o.a.createElement(k.a,{icon:this.props.icon||j.a}))))}}]),t}(a.Component),P=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={icon:j.g,muted:!1},n.buttonClick=function(e){console.log("[Mic] button clicked"),n.setState({muted:!n.state.muted},function(){n.props.onMute(n.state.muted)})},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({muted:this.props.muted})}},{key:"render",value:function(){return o.a.createElement(A,{id:"mic-button-div",style:{top:"calc(90% - 3rem)",left:"calc(95% - 3rem)"},icon:this.state.muted?j.h:j.g,onClick:this.buttonClick})}}]),t}(a.Component);function _(){return!(!document.webkitFullscreenElement&&!document.mozFullScreenElement)}var F=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={icon:j.e},e.onFullscreen=function(){console.log("fullscreen");var t=_();e.setState({icon:t?j.c:j.e})},e.buttonClick=function(e){console.log("[Fullscreen] button clicked"),function(e){if(e){var t=document.documentElement;t.mozRequestFullScreen&&t.mozRequestFullScreen()||t.webkitRequestFullScreen&&t.webkitRequestFullScreen()}else document.webkitCancelFullScreen&&document.webkitCancelFullScreen()||document.mozCancelFullScreen&&document.mozCancelFullScreen()}(!_())},document.addEventListener("webkitfullscreenchange",e.onFullscreen),document.addEventListener("mozfullscreenchange",e.onFullscreen),e}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement(A,{canTouch:!0,style:{top:"10%",left:"5%"},icon:this.state.icon,onClick:this.buttonClick,id:"fullscreen-button-div"})}}]),t}(a.Component),q=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).onClick=function(e){n.props.disabled||n.props.onClick(e)},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement(A,{disabled:this.props.disabled,style:this.props.style,buttonStyle:{width:"2rem",height:"2rem",fontSize:"1rem"},icon:this.props.icon,onClick:this.onClick,id:this.props.id})}}]),t}(a.Component),V=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement(q,{disabled:this.props.disabled,style:{top:"calc(10% - .5rem)",left:"calc(95% - 3rem)"},icon:j.j,onClick:this.props.onClick,id:"plus-button-div"})}}]),t}(q),B=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement(q,{disabled:this.props.disabled,style:{top:"calc(10% + 2rem)",left:"calc(95% - 3rem)"},icon:j.i,onClick:this.props.onClick,id:"minus-button-div"})}}]),t}(a.Component),J=(n(100),n(133)),I=n(131),Y=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).dd=o.a.createRef(),n.state={show:!1,fit_mode:"fill",quality:"quality_hi"},n.settingsChanged=function(e){var t=e.target,a=t.name,o=t.value;console.log("[Settings] changed",a,o,n.state),n.props.onChange(a,o),n.setState(Object(D.a)({},a,o))},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement(J.a,{drop:"up",style:{position:"fixed",top:"calc(90% - 3rem)",left:"5%"}},o.a.createElement(J.a.Toggle,{as:A,icon:j.b,embed:!0}),o.a.createElement(J.a.Menu,null,o.a.createElement(I.a,{className:"px-1 py-4"},o.a.createElement(I.a.Group,null,o.a.createElement(I.a.Label,null,"Fit mode"),o.a.createElement(I.a.Control,{as:"select",name:"fit_mode",onChange:this.settingsChanged,value:this.state.fit_mode},o.a.createElement("option",{value:"fill"},"Fill"),o.a.createElement("option",{value:"fit_both"},"Fit"),o.a.createElement("option",{value:"fit_width"},"Fit Width"),o.a.createElement("option",{value:"fit_height"},"Fit Height"))),o.a.createElement(I.a.Group,null,o.a.createElement(I.a.Label,null,"Quality"),o.a.createElement(I.a.Control,{as:"select",name:"quality",value:this.state.quality,onChange:this.settingsChanged},o.a.createElement("option",{value:"quality_low"},"Low"),o.a.createElement("option",{value:"quality_med"},"Medium"),o.a.createElement("option",{value:"quality_hi"},"High"))))))}}]),t}(a.Component),H=(n(110),n(111),50),L="translateX(".concat(25,"px) translateY(").concat(25,"px)"),X={0:"up",1:"right",2:"down",3:"left"},U=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).wrapperRef=o.a.createRef(),n.innerRef=o.a.createRef(),n.outerRef=o.a.createRef(),n.state={outerPressed:!1,innerTransform:L},n.onMouseDown=function(e){console.log(e)},n.onOuterDown=function(e){console.log("onOuterDown"),e.preventDefault(),n.setState({outerPressed:!0}),n.onWrapperMove(e,!0)},n.onOuterTouch=function(e){console.log("onOuterTouch"),console.log(e.touches,e.targetTouches),n.setState({outerPressed:!0}),n.onWrapperMove(e,!0)},n.onWrapperUp=function(e){n.state.outerPressed&&(console.log("onWrapperUp"),n.setState({outerPressed:!1,innerTransform:L}),n.props.onEnd&&n.props.onEnd())},n.onWrapperMove=function(e,t){if(t||n.state.outerPressed){e.preventDefault();var a=e.nativeEvent,o=(e.target,a.targetTouches?a.targetTouches[0].pageX:a.pageX),s=a.targetTouches?a.targetTouches[0].pageY:a.pageY;a.targetTouches&&(s-=a.targetTouches[0].radiusY/2),n.move(o,s)}},n.onWrapperOut=function(e){e.target==n.wrapperRef.current&&(console.log("onWrapperOut",e.target),n.onWrapperUp(e))},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"move",value:function(e,t){var n,a,o=this.outerRef.current.getBoundingClientRect(),s=e-25-o.x,r=t-25-o.y,i=o.x+o.width/2,c=o.y+o.height/2,l=e,u=t,d=Math.sqrt(Math.pow(i-l,2)+Math.pow(c-u,2)),h=Math.acos((i-l)/d),m=180*h/Math.PI;c-u<0?(m=360-m,n=Math.cos(Math.PI-h)*H+25,a=Math.sin(h)*H+25):(n=Math.cos(Math.PI-h)*H+25,a=Math.sin(-h)*H+25),m=(m+270)%360;var p=(Math.floor((m-45)/90)+1)%4;console.log(d/H,m,p),d>H&&(s=n,r=a),this.setState({innerTransform:"translateX(".concat(s,"px) translateY(").concat(r,"px)")}),X[p]||console.error("invalid dir: "+p),this.props.onMove&&this.props.onMove(m,d/H,X[p])}},{key:"render",value:function(){return o.a.createElement("div",{className:"joystick-wrapper fullscreen",onMouseMove:this.onWrapperMove,onMouseUp:this.onWrapperUp,onMouseLeave:this.onWrapperOut,onTouchMove:this.onWrapperMove,onTouchEnd:this.onWrapperUp,ref:this.wrapperRef,style:{visibility:this.state.outerPressed?"visible":"hidden",cursor:this.state.outerPressed?"grabbing":"auto"}},o.a.createElement("div",{className:"joystick-outer ".concat(this.state.outerPressed?"joystick-active":""," ").concat(this.props.className),onMouseDown:this.onOuterDown,onTouchStart:this.onOuterTouch,ref:this.outerRef,style:{cursor:this.state.outerPressed?"grabbing":"grab"}},o.a.createElement("div",{className:"joystick-inner",ref:this.innerRef,style:{transform:this.state.innerTransform}})))}}]),t}(a.Component),K=4,G=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).angle=null,n.force=null,n.tm=null,n.onMove=function(e,t,a){if(!a)return console.error("direction is invalid");var o={left:["h",t],right:["h",-t],down:["v",t],up:["v",-t]},s=Object(f.a)(o[a],2),r=s[0],i=s[1];n.angle=r,n.force=i,n.move()},n.onEnd=function(){n.tm&&(clearInterval(n.tm),n.tm=null),n.props.onEnd()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"move",value:function(){console.log(this.angle,this.force),this.props.onMove(this.angle,this.force)}},{key:"render",value:function(){return o.a.createElement(U,{onEnd:this.onEnd,onMove:this.onMove,className:"right-joystick"})}}]),t}(a.Component),Z=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).step_left=null,n.step_right=null,n.onMove=function(e,t){var a=t;a>1&&(a=1);var o=0;e<90?o=90*n.smoothAngle(e,K):e>=90&&e<180?o=90+90*(1-n.smoothAngle(180-e,K)):e>=180&&e<270?o=180+90*n.smoothAngle(e-180,K):e>=270&&e<360&&(o=270+90*(1-n.smoothAngle(360-e,K))),console.log("smoothA:",o),n.props.onMove(a,o)},n.onEnd=function(){n.props.onEnd()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"smoothAngle",value:function(e,t){return Math.expm1(e/(10*t))/Math.expm1(9/t)}},{key:"render",value:function(){return o.a.createElement(U,{onMove:this.onMove,onEnd:this.onEnd,className:"left-joystick"})}}]),t}(a.Component),Q=(n(112),n(75)),$=n(17),ee=1e3,te=4,ne=3,ae=1640,oe=1230,se=48,re=36,ie={KeyA:"left",KeyD:"right",KeyS:"down",KeyW:"up"},ce={quality_low:.3,quality_med:.5,quality_hi:1},le="ontouchstart"in window,ue=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={fit_width:!1,fit_height:!0},n.haveAudio=void 0,n.fitMode="fill",n.quality=1,n.resizeTm=0,n.scale=1,n.tX=0,n.tY=0,n.X=0,n.Y=0,n.video=o.a.createRef(),n.touchDown=function(e){le&&(e.preventDefault(),e.stopPropagation());var t=e.nativeEvent,a=t.touches?t.touches[0].pageX:t.pageX,o=t.touches?t.touches[0].pageY:t.pageY;n.X=a-n.tX,n.Y=o-n.tY},n.touchMove=function(e){le&&(e.preventDefault(),e.stopPropagation());var t=e.nativeEvent,a=e.target;if("mousemove"==t.type&&1==t.buttons||"touchmove"==t.type){e.preventDefault();var o=t.touches?t.touches[0].pageX:t.pageX,s=t.touches?t.touches[0].pageY:t.pageY,r=o-n.X,i=s-n.Y;console.debug(a,r);var c=n.video.current.getBoundingClientRect(),l=document.documentElement.clientWidth,u=document.documentElement.clientHeight,d=(c.width-l)/2,h=(c.height-u)/2;d>=0&&(r>0&&r>d?r=d:r<0&&r<-d&&(r=-d)),h>=0&&(i>0&&i>h?i=h:i<0&&i<-h&&(i=-h)),d>=0&&h>=0&&n.setTransform(r,i)}},n.playing=function(e){console.log(e),n.props.muted&&n.mute(!0),n.props.onStarted(n.haveAudio),n.resize()},n.paused=function(e){console.log(e)},n.time=function(e){n.props.onTime(e.target.currentTime)},n.resize=function(e){var t,a,o=document.documentElement.clientWidth*n.quality,s=document.documentElement.clientHeight*n.quality;console.log("".concat(o,"x").concat(s)),t=(a=Math.round(s/ne/2)*ne*2)*te/ne;var r=Math.abs(s-a),i=Math.abs(o-t);console.log("fit height: ".concat(t,"x").concat(a," ").concat(i,"x").concat(r," ").concat(t/a));var c=t,l=a;a=(t=Math.round(o/te/2)*te*2)*ne/te,r=Math.abs(s-a),i=Math.abs(o-t),console.log("fit width: ".concat(t,"x").concat(a," ").concat(i,"x").concat(r," ").concat(t/a));var u,d=t,h=a;switch(n.fitMode){case"fit_width":u={fit_width:!0,fit_height:!1},t=d,a=h;break;case"fit_height":u={fit_width:!1,fit_height:!0},t=c,a=l;break;case"fit_both":u={fit_width:!0,fit_height:!0},o/s>te/ne?(t=c,a=l):(t=d,a=h);break;case"fill":o/s<te/ne?(u={fit_width:!1,fit_height:!0},t=c,a=l):(u={fit_width:!0,fit_height:!1},t=d,a=h)}console.log("best fit: ".concat(t,"x").concat(a),u),t>=ae||a>=oe?(t=ae,a=oe):(t<=se||a<=re)&&(t=se,a=re);var m=t,p=a;n.setState(u,function(){n.zoom(0),n.resizeTm&&clearTimeout(n.resizeTm),n.resizeTm=setTimeout(function(){n.props.onResize(m,p),n.resizeTm=null},ee)})},n.onKeyDown=function(e){console.log(e.code),ie[e.code]&&n.props.onCameraMove(ie[e.code])},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.connectWebRTC().then(function(){e.resize()}),window.addEventListener("resize",function(t){e.resize(),console.log(t)}),window.addEventListener("keydown",function(t){e.onKeyDown(t)})}},{key:"componentDidUpdate",value:function(e){this.props.muted!=e.muted&&this.mute(this.props.muted)}},{key:"connectWebRTC",value:function(){var e=Object(v.a)(m.a.mark(function e(){var t,n,a,o,s,r,i,c,l,u,d,h,p,f=this;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.config.janus){e.next=2;break}return e.abrupt("return");case 2:return t=$.a.useDefaultDependencies({adapter:Q.a}),e.next=5,new Promise(function(e){return $.a.init({debug:"all",dependencies:t,callback:e})});case 5:return console.log("Janus inited"),n=function(){var e=Object(v.a)(m.a.mark(function e(t){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t,f.haveAudio),"NotAllowedError"!=t.name||!f.haveAudio){e.next=5;break}f.haveAudio=!1,e.next=11;break;case 5:if("No capture device found"!=t){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,f.props.onError(t);case 11:a.destroy();case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),$.a.isWebrtcSupported()||n("No WebRTC support... "),o=this,e.next=11,new Promise(function(e,t){a=new $.a({server:o.props.config.janus,success:e,error:n,destroyed:function(){return f.connectWebRTC()}})});case 11:return console.log("Janus connected"),s="streamingtest-"+$.a.randomString(12),e.next=15,new Promise(function(e,t){a.attach({plugin:"janus.plugin.streaming",opaqueId:s,success:e,error:n,onmessage:function(e,t){$.a.debug(" ::: Got a message :::"),$.a.debug(e);var a=e.result;a&&a.status?"started"==a.status&&(console.log("Streaming started!"),o.video.current.played.length&&o.playing()):e.error&&n(e.error),t&&($.a.debug("Handling SDP as well..."),$.a.debug(t),r.createAnswer({jsep:t,media:{audioSend:f.haveAudio,videoSend:!1},success:function(e){$.a.debug("Got SDP!"),$.a.debug(e),r.send({message:{request:"start"},jsep:e})},error:n}))},onremotestream:function(e){$.a.debug(" ::: Got a remote stream :::"),$.a.debug(e),console.log("Janus remote stream received");var t=o.video.current;$.a.attachMediaStream(t,e),t.muted=!1},oncleanup:function(){$.a.log(" ::: Got a cleanup notification :::")},slowLink:function(e,t){console.warn("slowlink",e,t)}})});case 15:return r=e.sent,this.streaming=r,console.log("Janus plugin attached"),e.next=20,navigator.mediaDevices.enumerateDevices();case 20:if(i=e.sent,void 0!==this.haveAudio){e.next=42;break}for(c=!0,l=!1,u=void 0,e.prev=25,d=i[Symbol.iterator]();!(c=(h=d.next()).done);c=!0)"audioinput"==h.value.kind&&(this.haveAudio=!0);e.next=33;break;case 29:e.prev=29,e.t0=e.catch(25),l=!0,u=e.t0;case 33:e.prev=33,e.prev=34,c||null==d.return||d.return();case 36:if(e.prev=36,!l){e.next=39;break}throw u;case 39:return e.finish(36);case 40:return e.finish(33);case 41:void 0===this.haveAudio&&(this.haveAudio=!1);case 42:return e.next=44,new Promise(function(e){return r.send({message:{request:"list"},success:e})});case 44:if((p=e.sent).list&&1==p.list[0].id){e.next=47;break}throw"Wrong stream received";case 47:r.send({message:{request:"watch",id:1}});case 48:case"end":return e.stop()}},e,this,[[25,29,33,41],[34,,36,40]])}));return function(){return e.apply(this,arguments)}}()},{key:"set",value:function(e,t){if("fit_mode"==e)this.fitMode=t;else{if("quality"!=e)return void console.error('Unknown "'.concat(e,'"'));this.quality=ce[t]}this.resize()}},{key:"setTransform",value:function(e,t,n){var a="translateX( calc( ".concat(e,"px - 50% ) )");this.state.fit_width?a+="translateY( calc( ".concat(t,"px - 50% ) )"):a+="translateY(".concat(t,"px)"),n||(n=this.scale),a+=" scale(".concat(n,")"),this.setState({transform:a}),this.tX=e,this.tY=t}},{key:"zoom",value:function(e){0==e?this.scale=1:this.scale+=e,this.setTransform(0,0)}},{key:"mute",value:function(e){this.haveAudio&&(console.log("mute",e),this.streaming&&(e?this.streaming.muteAudio():this.streaming.unmuteAudio()))}},{key:"status",value:function(){if(!this.streaming)return"<no video>";var e=parseInt(this.streaming.getBitrate()),t=this.video.current,n=t.videoWidth,a=t.videoHeight;return"safari"==$.a.webRTCAdapter.browserDetails.browser&&(e=Math.round(e/1e3)),"".concat(n,"x").concat(a," @ ").concat(e," kb/s")}},{key:"render",value:function(){return o.a.createElement("video",{autoPlay:!0,muted:!0,playsInline:!0,loop:!0,id:"myVideo",className:"".concat(this.state.fit_width?"fit_width":""," ").concat(this.state.fit_height?"fit_height":""),style:{transform:this.state.transform},ref:this.video,onMouseDown:this.touchDown,onMouseMove:this.touchMove,onTouchStart:this.touchDown,onTouchMove:this.touchMove,onKeyDown:this.onKeyDown,onPlaying:this.playing,onTimeUpdate:this.time},"Your browser does not support HTML5 video.")}}]),t}(a.Component),de=(n(113),n(132)),he=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={show:!1,message:{header:"",text:""}},n.handleClose=function(e){var t=e&&e.target.name;n.setState({show:!1},function(){t&&n.onClose&&n.onClose(t)})},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"show",value:function(){var e=Object(v.a)(m.a.mark(function e(t){var n=this;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){n.setState({show:!0,message:t},function(){n.onClose=e})}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return o.a.createElement(de.a,{show:this.state.show,onHide:this.handleClose,dialogClassName:"dialog-div"},o.a.createElement(de.a.Header,{closeButton:!0},o.a.createElement(k.a,{icon:this.props.icon||j.d,className:"dialog-icon"}),o.a.createElement(de.a.Title,null,this.state.message.header)),o.a.createElement(de.a.Body,null,this.state.message.text),o.a.createElement(de.a.Footer,null,o.a.createElement(y.a,{variant:"secondary",onClick:this.handleClose,name:"retry"},"Retry"),o.a.createElement(y.a,{variant:"primary",onClick:this.handleClose,name:"reload"},"Reload")))}}]),t}(a.Component),me=(n(127),function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{id:"statusDiv"},o.a.createElement("span",{id:"videoInfoSpan"},this.props.info),o.a.createElement("br",null),o.a.createElement("span",{id:"videoExtraSpan"},this.props.extra))}}]),t}(a.Component)),pe=(n(128),function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"animationload ".concat(this.props.hidden?"animationload-after":""),id:"loadingAnim"},o.a.createElement("div",{className:"osahanloading"}),o.a.createElement("h3",{className:"loadingMessage"},"Loading"))}}]),t}(a.Component)),fe=.5,ve=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={joystickConnected:!1,plusDisabled:!0,minusDisabled:!0,statusText:"",loading:!0,muted:!0,haveSound:!1},e.config=null,e.reconnectTimeout=0,e.ws=null,e.video=o.a.createRef(),e.modal=o.a.createRef(),e.plus=o.a.createRef(),e.minus=o.a.createRef(),e.status=o.a.createRef(),e.spinner=o.a.createRef(),e.onJoystickMove=function(t,n){e.sendCommand({cmd:"move",force:t,angle:n})},e.onJoystickMoveEnd=function(){e.sendCommand({cmd:"end",what:"move"})},e.onSettingsChanged=function(t,n){console.log("".concat(t," = ").concat(n),e.video),e.video.current.set(t,n)},e.onVideoError=function(){var t=Object(v.a)(m.a.mark(function t(n){var a,s;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.error(n),a=n.name&&n.message?o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null," ","Name: ".concat(n.name)," "),o.a.createElement("p",null," ","Message: ".concat(n.message)," ")):n,t.next=4,e.modal.current.show({header:"Video Error",text:a});case 4:s=t.sent,console.log(s),"reload"==s?window.location.reload():e.setState({loading:!0});case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),e.onVideoStarted=function(t){console.log("VIDEO STARTED"),e.setState({loading:!1,haveSound:t}),e.updateScaleButtons(),e.statusInterval||(e.statusInterval=setInterval(function(){e.setState({statusText:e.video.current.status()})},1e3))},e.onVideoTime=function(t){e.setState({statusExtra:t.toFixed(1)})},e.onVideoSize=function(t,n){e.sendCommand({cmd:"resolution",width:t,height:n}),e.updateScaleButtons()},e.onZoomIn=function(){e.video.current.zoom(.1),e.updateScaleButtons()},e.onZoomOut=function(){e.video.current.zoom(-.1),e.updateScaleButtons()},e.onCameraMove=function(t){console.log(t);var n={left:["h",fe],right:["h",-fe],down:["v",fe],up:["v",-fe]},a=Object(f.a)(n[t],2),o=a[0],s=a[1];e.sendCommand({cmd:"look",plain:o,step:s})},e.onCameraJoystickEnd=function(){console.log("camera joystick: end"),e.sendCommand({cmd:"end",what:"look"})},e.onCameraJoystickMove=function(t,n){console.log(t,n),e.sendCommand({cmd:"look",plain:t,step:n})},e.onMute=function(t){e.setState({muted:!e.state.muted})},e.fetchConfig().then(function(){return e.connectJoystick()}),e}return Object(d.a)(t,e),Object(c.a)(t,[{key:"connectJoystick",value:function(){var e=this;if(this.state.config.joystick){var t=null;try{console.log("connecting joystick..."),this.reconnectTimeout=0,this.state.config.joystick&&(t=new WebSocket(this.state.config.joystick))}catch(n){return console.log("connecting joystick: error",n),void(this.reconnectTimeout?console.log("timeout already started"):this.reconnectTimeout=setTimeout(function(){return e.connectJoystick()},1e3))}t&&(t.onopen=function(){console.log("joystick connected!"),e.ws=t,e.ws.send(JSON.stringify({cmd:"hello"})),e.setState({joystickConnected:!0})},t.onmessage=function(e){console.log(e)},t.onerror=function(e){},t.onclose=function(){e.ws=null,e.setState({joystickConnected:!1}),console.log("joystick disconnected"),e.reconnectTimeout?console.log("timeout already started"):e.reconnectTimeout=setTimeout(function(){return e.connectJoystick()},1e3)})}else this.setState({joystickConnected:!0})}}]),Object(c.a)(t,[{key:"sendCommand",value:function(e){this.ws&&(e.timestamp=Date.now(),this.ws.send(JSON.stringify(e)))}},{key:"updateScaleButtons",value:function(){this.setState({minusDisabled:this.video.current.scale<=1,plusDisabled:!1})}},{key:"fetchConfig",value:function(){var e=Object(v.a)(m.a.mark(function e(){var t,n,a,o;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("web-config.json");case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,a=n,console.log(a),(o=a).janus=a.janus&&a.janus.replace(/{HOST}/g,document.location.host),o.joystick=a.joystick&&a.joystick.replace(/{HOST}/g,document.location.host),this.setState({config:o});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e;return o.a.createElement(o.a.Fragment,null,o.a.createElement(pe,{ref:this.spinner,hidden:!this.state.loading}),this.state.config&&o.a.createElement(ue,(e={ref:this.video,config:this.state.config,onStarted:this.onVideoStarted,onError:this.onVideoError,onResize:this.onVideoSize,onCameraMove:this.onCameraMove},Object(D.a)(e,"onResize",this.onVideoSize),Object(D.a)(e,"onTime",this.onVideoTime),Object(D.a)(e,"muted",this.state.muted),e)),!this.state.loading&&this.state.haveSound&&o.a.createElement(P,{onMute:this.onMute,muted:this.state.muted}),o.a.createElement(F,null),this.state.joystickConnected&&o.a.createElement(Z,{onMove:this.onJoystickMove,onEnd:this.onJoystickMoveEnd}),this.state.joystickConnected&&o.a.createElement(G,{onEnd:this.onCameraJoystickEnd,onMove:this.onCameraJoystickMove}),o.a.createElement(Y,{onChange:this.onSettingsChanged}),o.a.createElement(V,{onClick:this.onZoomIn,ref:this.plus,disabled:this.state.plusDisabled}),o.a.createElement(B,{onClick:this.onZoomOut,ref:this.minus,disabled:this.state.minusDisabled}),o.a.createElement(he,{ref:this.modal}),o.a.createElement(me,{ref:this.status,info:this.state.statusText,extra:this.state.statusExtra}))}}]),t}(a.Component),be=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={showDrive:!1},n.onDrive=function(){n.setState({showDrive:!0})},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.state.showDrive?(document.getElementsByTagName("html")[0].classList.toggle("fullscreen-html",!0),document.getElementById("root").classList.toggle("fullscreen",!0),document.body.addEventListener("touchmove",function(e){return e.preventDefault()},{passive:!1}),o.a.createElement(ve,null)):o.a.createElement(N,{onDrive:this.onDrive})}}]),t}(a.Component);r.a.render(o.a.createElement(be,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},76:function(e,t,n){e.exports=n(129)},81:function(e,t,n){},82:function(e,t,n){},85:function(e,t,n){},98:function(e,t,n){},99:function(e,t,n){}},[[76,1,2]]]);
//# sourceMappingURL=main.aed5388a.chunk.js.map